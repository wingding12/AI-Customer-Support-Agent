{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 55, "column": 0}, "map": {"version":3,"sources":["file:///Users/williamding/Documents/GitHub/AI-Customer-Support-Agent/src/data/aven-knowledge.ts"],"sourcesContent":["export interface AvenKnowledge {\n  id: string;\n  category: string;\n  topic: string;\n  content: string;\n  metadata?: Record<string, string | number | boolean>;\n}\n\nexport const avenKnowledgeBase: AvenKnowledge[] = [\n  // Company Overview\n  {\n    id: \"aven-001\",\n    category: \"company\",\n    topic: \"About Aven\",\n    content:\n      \"Aven is a revolutionary fintech company that helps people save money while paying off credit card debt. We provide intelligent credit solutions that empower individuals to take control of their financial future. Founded in 2023, Aven has quickly become a trusted partner for thousands of users looking to reduce their debt burden and improve their financial health.\",\n  },\n  {\n    id: \"aven-002\",\n    category: \"company\",\n    topic: \"Mission\",\n    content:\n      \"Aven's mission is to democratize access to smart financial tools and help millions of Americans escape the cycle of credit card debt. We believe everyone deserves fair and transparent financial services that actually work in their favor, not against them.\",\n  },\n  {\n    id: \"aven-003\",\n    category: \"company\",\n    topic: \"Values\",\n    content:\n      \"Our core values include transparency, customer empowerment, financial inclusion, and innovation. We're committed to providing clear, honest information about all our products and services, with no hidden fees or surprise charges.\",\n  },\n\n  // Products and Services\n  {\n    id: \"aven-004\",\n    category: \"products\",\n    topic: \"Aven Credit Card\",\n    content:\n      \"The Aven Credit Card is designed specifically for people paying off debt. It offers 0% APR on balance transfers for 21 months, no annual fee, and smart spending controls to help you avoid adding new debt while paying off existing balances. The card also provides cashback rewards on essential purchases like groceries and gas.\",\n  },\n  {\n    id: \"aven-005\",\n    category: \"products\",\n    topic: \"Balance Transfer\",\n    content:\n      \"Aven offers one of the longest 0% APR balance transfer periods in the industry - 21 months. There's a one-time balance transfer fee of 3% or $5, whichever is greater. You can transfer balances from multiple cards, up to your approved credit limit. The balance transfer must be completed within 60 days of account opening.\",\n  },\n  {\n    id: \"aven-006\",\n    category: \"products\",\n    topic: \"Cashback Rewards\",\n    content:\n      \"Earn 3% cashback on groceries, 2% on gas and transportation, and 1% on all other purchases. There's no limit to the cashback you can earn, and rewards never expire. Cashback can be redeemed as a statement credit, direct deposit to your bank account, or applied directly to your balance.\",\n  },\n  {\n    id: \"aven-007\",\n    category: \"products\",\n    topic: \"Debt Management Tools\",\n    content:\n      \"Aven provides free debt management tools including a debt payoff calculator, personalized payoff plans, spending insights, and budget tracking. Our AI-powered recommendations help you optimize your payment strategy to save the most on interest and pay off debt faster.\",\n  },\n\n  // Features and Benefits\n  {\n    id: \"aven-008\",\n    category: \"features\",\n    topic: \"Smart Notifications\",\n    content:\n      \"Get intelligent alerts about your spending, payment due dates, and opportunities to save money. Our system learns your patterns and provides personalized insights to help you stay on track with your financial goals.\",\n  },\n  {\n    id: \"aven-009\",\n    category: \"features\",\n    topic: \"Financial Education\",\n    content:\n      \"Access our comprehensive library of financial education resources, including articles, videos, and interactive tools. Topics cover credit score improvement, budgeting basics, debt reduction strategies, and long-term financial planning.\",\n  },\n  {\n    id: \"aven-010\",\n    category: \"features\",\n    topic: \"Mobile App\",\n    content:\n      \"The Aven mobile app is available for iOS and Android. Features include instant balance checks, payment scheduling, spending categorization, virtual card numbers for online shopping, and biometric security. The app has a 4.8-star rating with over 10,000 reviews.\",\n  },\n\n  // Account Management\n  {\n    id: \"aven-011\",\n    category: \"account\",\n    topic: \"Eligibility Requirements\",\n    content:\n      \"To apply for an Aven Credit Card, you must be 18 years or older, have a valid Social Security number, have a US mailing address, and have a credit score of at least 670. We perform a hard credit inquiry during the application process.\",\n  },\n  {\n    id: \"aven-012\",\n    category: \"account\",\n    topic: \"Application Process\",\n    content:\n      \"The application process takes about 5 minutes online. You'll need to provide personal information, employment details, and income verification. Most decisions are instant, though some applications may require additional review within 7-10 business days. Once approved, your card arrives within 7-10 business days.\",\n  },\n  {\n    id: \"aven-013\",\n    category: \"account\",\n    topic: \"Credit Limits\",\n    content:\n      \"Credit limits range from $1,000 to $25,000 based on your creditworthiness and income. You can request a credit limit increase after 6 months of on-time payments. Automatic reviews for credit limit increases occur every 6 months.\",\n  },\n  {\n    id: \"aven-014\",\n    category: \"account\",\n    topic: \"Payment Options\",\n    content:\n      \"Make payments through the mobile app, online portal, automatic payments, phone payments, or mail. We accept payments from checking accounts, savings accounts, and debit cards. Credit card payments from other cards are not accepted. Payments made before 5 PM ET on business days are credited the same day.\",\n  },\n\n  // Fees and Rates\n  {\n    id: \"aven-015\",\n    category: \"fees\",\n    topic: \"Fee Structure\",\n    content:\n      \"No annual fee, no over-limit fees, no foreign transaction fees. Balance transfer fee: 3% or $5 minimum. Cash advance fee: 5% or $10 minimum. Late payment fee: up to $40. Returned payment fee: up to $40.\",\n  },\n  {\n    id: \"aven-016\",\n    category: \"fees\",\n    topic: \"Interest Rates\",\n    content:\n      \"0% intro APR on balance transfers for 21 months, then 14.99% - 24.99% variable APR based on creditworthiness. 0% intro APR on purchases for 12 months, then the same variable APR applies. Cash advance APR: 26.99% variable, applied immediately with no grace period.\",\n  },\n\n  // Customer Support\n  {\n    id: \"aven-017\",\n    category: \"support\",\n    topic: \"Contact Options\",\n    content:\n      \"24/7 phone support at 1-800-AVEN-HLP (1-800-283-6457). Live chat available on website and mobile app from 8 AM to 11 PM ET. Email support at support@aven.com with response within 24 hours. In-app messaging for account-specific questions.\",\n  },\n  {\n    id: \"aven-018\",\n    category: \"support\",\n    topic: \"Lost or Stolen Card\",\n    content:\n      \"Report lost or stolen cards immediately through the app or by calling 1-800-AVEN-HLP. We'll freeze your card instantly and send a replacement via expedited shipping at no charge. You won't be liable for unauthorized charges made after you report the card missing.\",\n  },\n  {\n    id: \"aven-019\",\n    category: \"support\",\n    topic: \"Dispute Process\",\n    content:\n      \"File disputes for unauthorized or incorrect charges through the app or online portal. We'll issue a provisional credit within 2 business days while investigating. Most disputes are resolved within 30 days. You'll receive written confirmation of the resolution.\",\n  },\n\n  // Security and Privacy\n  {\n    id: \"aven-020\",\n    category: \"security\",\n    topic: \"Security Features\",\n    content:\n      \"Bank-level 256-bit encryption, two-factor authentication, biometric login options, real-time fraud monitoring, instant card freeze/unfreeze, virtual card numbers for online shopping, and zero liability protection for unauthorized charges.\",\n  },\n  {\n    id: \"aven-021\",\n    category: \"security\",\n    topic: \"Privacy Policy\",\n    content:\n      \"We never sell your personal information to third parties. Data is used only to provide services, improve products, and comply with legal requirements. You can request your data or deletion at any time. We're compliant with CCPA, GDPR, and all federal privacy regulations.\",\n  },\n\n  // FAQs\n  {\n    id: \"aven-022\",\n    category: \"faq\",\n    topic: \"How long does balance transfer take?\",\n    content:\n      \"Balance transfers typically complete within 5-7 business days, though some may take up to 14 days depending on the issuing bank. Continue making minimum payments on your old card until the transfer is confirmed complete.\",\n  },\n  {\n    id: \"aven-023\",\n    category: \"faq\",\n    topic: \"Can I transfer multiple balances?\",\n    content:\n      \"Yes, you can transfer balances from multiple cards as long as the total doesn't exceed your credit limit. Each transfer is processed separately and may complete at different times.\",\n  },\n  {\n    id: \"aven-024\",\n    category: \"faq\",\n    topic: \"Does applying hurt my credit score?\",\n    content:\n      \"We perform a hard credit inquiry during the application process, which may temporarily lower your credit score by a few points. However, consolidating debt with our card can improve your credit utilization ratio and potentially increase your score over time.\",\n  },\n  {\n    id: \"aven-025\",\n    category: \"faq\",\n    topic: \"What happens after the intro APR period?\",\n    content:\n      \"After the 21-month intro period for balance transfers (or 12 months for purchases), the variable APR of 14.99% - 24.99% applies to any remaining balance. We'll notify you 45 days before the intro period ends.\",\n  },\n  {\n    id: \"aven-026\",\n    category: \"faq\",\n    topic: \"Can I increase my credit limit?\",\n    content:\n      \"You can request a credit limit increase after 6 months of on-time payments through the app or online portal. We also automatically review accounts every 6 months for potential increases. Requests may result in a soft or hard credit inquiry.\",\n  },\n  {\n    id: \"aven-027\",\n    category: \"faq\",\n    topic: \"Is there a penalty APR?\",\n    content:\n      \"No, Aven does not charge penalty APRs. Your rate remains the same even if you miss a payment, though late fees may apply. We believe in helping you succeed, not penalizing you when you're struggling.\",\n  },\n\n  // Special Programs\n  {\n    id: \"aven-028\",\n    category: \"programs\",\n    topic: \"Financial Hardship Program\",\n    content:\n      \"If you're experiencing financial hardship, we offer payment deferrals, reduced interest rates, and modified payment plans. Contact our hardship team at 1-800-AVEN-HLP to discuss options. We're here to help you through difficult times.\",\n  },\n  {\n    id: \"aven-029\",\n    category: \"programs\",\n    topic: \"Refer a Friend\",\n    content:\n      \"Earn $50 for each friend who's approved for an Aven card through your referral link. Your friend also gets a $50 bonus after their first purchase. There's no limit to how many friends you can refer.\",\n  },\n  {\n    id: \"aven-030\",\n    category: \"programs\",\n    topic: \"Credit Score Monitoring\",\n    content:\n      \"Free FICO score updates monthly, credit report monitoring with alerts for changes, personalized tips to improve your score, and credit score simulator to see impact of financial decisions. All included at no extra charge with your Aven card.\",\n  },\n];\n\n// Helper function to search knowledge base\nexport function searchKnowledge(query: string): AvenKnowledge[] {\n  const lowercaseQuery = query.toLowerCase();\n  return avenKnowledgeBase.filter(\n    item =>\n      item.content.toLowerCase().includes(lowercaseQuery) ||\n      item.topic.toLowerCase().includes(lowercaseQuery) ||\n      item.category.toLowerCase().includes(lowercaseQuery)\n  );\n}\n\n// Get knowledge by category\nexport function getKnowledgeByCategory(category: string): AvenKnowledge[] {\n  return avenKnowledgeBase.filter(item => item.category === category);\n}\n\n// Get all categories\nexport function getCategories(): string[] {\n  return [...new Set(avenKnowledgeBase.map(item => item.category))];\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 264, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 270, "column": 0}, "map": {"version":3,"sources":["file:///Users/williamding/Documents/GitHub/AI-Customer-Support-Agent/src/utils/logger.ts"],"sourcesContent":["/* eslint-disable */\n\nconst isServer = typeof window === \"undefined\";\n\nexport class Logger {\n  private context: string;\n  private isServerContext: boolean;\n  private colors = {\n    reset: \"\\x1b[0m\",\n    red: \"\\x1b[31m\",\n    yellow: \"\\x1b[33m\",\n    blue: \"\\x1b[34m\",\n    gray: \"\\x1b[90m\",\n    bold: \"\\x1b[1m\",\n    magenta: \"\\x1b[35m\",\n  };\n\n  constructor(context: string) {\n    this.context = context;\n    this.isServerContext = isServer;\n  }\n\n  private shouldLog(): boolean {\n    // Always log server-side actions\n    if (this.isServerContext) return true;\n    // Only log client-side in development\n    return process.env.NODE_ENV === \"development\";\n  }\n\n  private formatMessage(level: string, message: string, data?: any) {\n    const timestamp = new Date().toISOString();\n    const environment = this.isServerContext ? \"[SERVER]\" : \"[CLIENT]\";\n    const prefix = `${timestamp} ${environment} ${this.context}:`;\n    return { prefix, message, ...(data && { data }) };\n  }\n\n  private colorize(color: keyof typeof this.colors, text: string): string {\n    // Only apply colors on the server side where they work\n    if (!this.isServerContext) return text;\n    return `${this.colors[color]}${text}${this.colors.reset}`;\n  }\n\n  private formatLogLevel(level: string): string {\n    return `[${level.toUpperCase()}]`;\n  }\n\n  private formatOutput({\n    prefix,\n    message,\n    data,\n  }: {\n    prefix: string;\n    message: string;\n    data?: any;\n  }) {\n    const logParts = [prefix, message];\n    if (data) {\n      logParts.push(\"\\n\" + JSON.stringify(data, null, 2));\n    }\n    return logParts.join(\" \");\n  }\n\n  info(message: string, data?: any) {\n    if (!this.shouldLog()) return;\n    const formattedData = this.formatMessage(\"info\", message, data);\n    console.log(\n      this.colorize(\"blue\", this.formatLogLevel(\"info\")) +\n        \" \" +\n        this.formatOutput(formattedData)\n    );\n  }\n\n  error(message: string, error?: Error | unknown, data?: any) {\n    if (!this.shouldLog()) return;\n    const errorData =\n      error instanceof Error\n        ? { name: error.name, message: error.message, stack: error.stack }\n        : error;\n\n    const formattedData = this.formatMessage(\"error\", message, {\n      ...data,\n      error: errorData,\n    });\n\n    console.error(\n      this.colorize(\"red\", this.colors.bold + this.formatLogLevel(\"error\")) +\n        \" \" +\n        this.formatOutput(formattedData)\n    );\n  }\n\n  warn(message: string, data?: any) {\n    if (!this.shouldLog()) return;\n    const formattedData = this.formatMessage(\"warn\", message, data);\n    console.warn(\n      this.colorize(\"yellow\", this.formatLogLevel(\"warn\")) +\n        \" \" +\n        this.formatOutput(formattedData)\n    );\n  }\n\n  debug(message: string, data?: any) {\n    if (!this.shouldLog()) return;\n    const formattedData = this.formatMessage(\"debug\", message, data);\n    console.debug(\n      this.colorize(\"gray\", this.formatLogLevel(\"debug\")) +\n        \" \" +\n        this.formatOutput(formattedData)\n    );\n  }\n\n  // New method specifically for server actions\n  action(message: string, data?: any) {\n    if (!this.shouldLog()) return;\n    const formattedData = this.formatMessage(\"action\", message, data);\n    console.log(\n      this.colorize(\"magenta\", this.formatLogLevel(\"action\")) +\n        \" \" +\n        this.formatOutput(formattedData)\n    );\n  }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 361, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 367, "column": 0}, "map": {"version":3,"sources":["file:///Users/williamding/Documents/GitHub/AI-Customer-Support-Agent/src/config/env.ts"],"sourcesContent":["import { z } from \"zod\";\nimport { Logger } from \"@/utils/logger\";\n\nconst logger = new Logger(\"Config:Env\");\n\n// Schema for environment variables\nconst envSchema = z.object({\n  NODE_ENV: z.string().default(\"development\"),\n  NEXT_PUBLIC_APP_URL: z.string().default(\"http://localhost:3000\"),\n\n  // OpenAI Configuration\n  OPENAI_API_KEY: z.string().optional(),\n\n  // Pinecone Configuration\n  PINECONE_API_KEY: z.string().optional(),\n  PINECONE_ENVIRONMENT: z.string().optional(),\n  PINECONE_INDEX_NAME: z.string().default(\"aven-knowledge-base\"),\n\n  // Vapi Configuration\n  VAPI_API_KEY: z.string().optional(),\n  NEXT_PUBLIC_VAPI_PUBLIC_KEY: z.string().optional(),\n  NEXT_PUBLIC_VAPI_ASSISTANT_ID: z.string().optional(),\n});\n\n// Function to validate environment variables\nconst validateEnv = () => {\n  try {\n    logger.info(\"Validating environment variables\");\n    const env = {\n      NODE_ENV: process.env.NODE_ENV,\n      NEXT_PUBLIC_APP_URL: process.env.NEXT_PUBLIC_APP_URL,\n      OPENAI_API_KEY: process.env.OPENAI_API_KEY,\n      PINECONE_API_KEY: process.env.PINECONE_API_KEY,\n      PINECONE_ENVIRONMENT: process.env.PINECONE_ENVIRONMENT,\n      PINECONE_INDEX_NAME: process.env.PINECONE_INDEX_NAME,\n      VAPI_API_KEY: process.env.VAPI_API_KEY,\n      NEXT_PUBLIC_VAPI_PUBLIC_KEY: process.env.NEXT_PUBLIC_VAPI_PUBLIC_KEY,\n      NEXT_PUBLIC_VAPI_ASSISTANT_ID: process.env.NEXT_PUBLIC_VAPI_ASSISTANT_ID,\n    };\n    const parsed = envSchema.parse(env);\n    logger.info(\"Environment variables validated successfully\");\n    return parsed;\n  } catch (error) {\n    if (error instanceof z.ZodError) {\n      const missingVars = error.errors.map(err => err.path.join(\".\"));\n      logger.error(\"Invalid environment variables\", { error: { missingVars } });\n      console.warn(\n        `⚠️ Missing optional environment variables: ${missingVars.join(\n          \", \"\n        )}. Some features may not work properly.`\n      );\n      // Return partial env with defaults\n      return envSchema.parse({\n        NODE_ENV: process.env.NODE_ENV || \"development\",\n        NEXT_PUBLIC_APP_URL:\n          process.env.NEXT_PUBLIC_APP_URL || \"http://localhost:3000\",\n        OPENAI_API_KEY: process.env.OPENAI_API_KEY || \"\",\n        PINECONE_API_KEY: process.env.PINECONE_API_KEY || \"\",\n        PINECONE_ENVIRONMENT: process.env.PINECONE_ENVIRONMENT || \"\",\n        PINECONE_INDEX_NAME:\n          process.env.PINECONE_INDEX_NAME || \"aven-knowledge-base\",\n        VAPI_API_KEY: process.env.VAPI_API_KEY || \"\",\n        NEXT_PUBLIC_VAPI_PUBLIC_KEY:\n          process.env.NEXT_PUBLIC_VAPI_PUBLIC_KEY || \"\",\n        NEXT_PUBLIC_VAPI_ASSISTANT_ID:\n          process.env.NEXT_PUBLIC_VAPI_ASSISTANT_ID || \"\",\n      });\n    }\n    throw error;\n  }\n};\n\nexport const env = validateEnv();\n"],"names":[],"mappings":";;;AACA;AADA;;;AAGA,MAAM,SAAS,IAAI,wHAAA,CAAA,SAAM,CAAC;AAE1B,mCAAmC;AACnC,MAAM,YAAY,sIAAA,CAAA,IAAC,CAAC,MAAM,CAAC;IACzB,UAAU,sIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,OAAO,CAAC;IAC7B,qBAAqB,sIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,OAAO,CAAC;IAExC,uBAAuB;IACvB,gBAAgB,sIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ;IAEnC,yBAAyB;IACzB,kBAAkB,sIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ;IACrC,sBAAsB,sIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ;IACzC,qBAAqB,sIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,OAAO,CAAC;IAExC,qBAAqB;IACrB,cAAc,sIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ;IACjC,6BAA6B,sIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ;IAChD,+BAA+B,sIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ;AACpD;AAEA,6CAA6C;AAC7C,MAAM,cAAc;IAClB,IAAI;QACF,OAAO,IAAI,CAAC;QACZ,MAAM,MAAM;YACV,QAAQ;YACR,qBAAqB,QAAQ,GAAG,CAAC,mBAAmB;YACpD,gBAAgB,QAAQ,GAAG,CAAC,cAAc;YAC1C,kBAAkB,QAAQ,GAAG,CAAC,gBAAgB;YAC9C,sBAAsB,QAAQ,GAAG,CAAC,oBAAoB;YACtD,qBAAqB,QAAQ,GAAG,CAAC,mBAAmB;YACpD,cAAc,QAAQ,GAAG,CAAC,YAAY;YACtC,6BAA6B,QAAQ,GAAG,CAAC,2BAA2B;YACpE,+BAA+B,QAAQ,GAAG,CAAC,6BAA6B;QAC1E;QACA,MAAM,SAAS,UAAU,KAAK,CAAC;QAC/B,OAAO,IAAI,CAAC;QACZ,OAAO;IACT,EAAE,OAAO,OAAO;QACd,IAAI,iBAAiB,sIAAA,CAAA,IAAC,CAAC,QAAQ,EAAE;YAC/B,MAAM,cAAc,MAAM,MAAM,CAAC,GAAG,CAAC,CAAA,MAAO,IAAI,IAAI,CAAC,IAAI,CAAC;YAC1D,OAAO,KAAK,CAAC,iCAAiC;gBAAE,OAAO;oBAAE;gBAAY;YAAE;YACvE,QAAQ,IAAI,CACV,CAAC,2CAA2C,EAAE,YAAY,IAAI,CAC5D,MACA,sCAAsC,CAAC;YAE3C,mCAAmC;YACnC,OAAO,UAAU,KAAK,CAAC;gBACrB,UAAU,mDAAwB;gBAClC,qBACE,QAAQ,GAAG,CAAC,mBAAmB,IAAI;gBACrC,gBAAgB,QAAQ,GAAG,CAAC,cAAc,IAAI;gBAC9C,kBAAkB,QAAQ,GAAG,CAAC,gBAAgB,IAAI;gBAClD,sBAAsB,QAAQ,GAAG,CAAC,oBAAoB,IAAI;gBAC1D,qBACE,QAAQ,GAAG,CAAC,mBAAmB,IAAI;gBACrC,cAAc,QAAQ,GAAG,CAAC,YAAY,IAAI;gBAC1C,6BACE,QAAQ,GAAG,CAAC,2BAA2B,IAAI;gBAC7C,+BACE,QAAQ,GAAG,CAAC,6BAA6B,IAAI;YACjD;QACF;QACA,MAAM;IACR;AACF;AAEO,MAAM,MAAM"}},
    {"offset": {"line": 434, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 536, "column": 0}, "map": {"version":3,"sources":["file:///Users/williamding/Documents/GitHub/AI-Customer-Support-Agent/src/lib/embeddings.ts"],"sourcesContent":["import OpenAI from \"openai\";\nimport type { ChatCompletionMessageParam } from \"openai/resources/chat/completions\";\nimport { env } from \"@/config/env\";\nimport { Logger } from \"@/utils/logger\";\n\nconst logger = new Logger(\"Embeddings\");\n\nlet openaiClient: OpenAI | null = null;\n\nfunction getOpenAIClient(): OpenAI | null {\n  if (!env.OPENAI_API_KEY) {\n    logger.warn(\"OpenAI API key not configured\");\n    return null;\n  }\n\n  if (!openaiClient) {\n    openaiClient = new OpenAI({\n      apiKey: env.OPENAI_API_KEY,\n    });\n    logger.info(\"OpenAI client initialized\");\n  }\n\n  return openaiClient;\n}\n\nexport async function createEmbedding(text: string): Promise<number[] | null> {\n  const client = getOpenAIClient();\n  if (!client) {\n    logger.warn(\"Cannot create embedding - OpenAI client not available\");\n    return null;\n  }\n\n  try {\n    const response = await client.embeddings.create({\n      model: \"text-embedding-ada-002\",\n      input: text,\n    });\n\n    const embedding = response.data[0].embedding;\n    logger.debug(`Created embedding for text (${text.length} chars)`);\n    return embedding;\n  } catch (error) {\n    logger.error(\"Failed to create embedding\", { error });\n    return null;\n  }\n}\n\nexport async function createEmbeddings(\n  texts: string[]\n): Promise<number[][] | null> {\n  const client = getOpenAIClient();\n  if (!client) {\n    logger.warn(\"Cannot create embeddings - OpenAI client not available\");\n    return null;\n  }\n\n  try {\n    const response = await client.embeddings.create({\n      model: \"text-embedding-ada-002\",\n      input: texts,\n    });\n\n    const embeddings = response.data.map(item => item.embedding);\n    logger.info(`Created ${embeddings.length} embeddings`);\n    return embeddings;\n  } catch (error) {\n    logger.error(\"Failed to create embeddings\", { error });\n    return null;\n  }\n}\n\nexport async function generateResponse(\n  prompt: string,\n  context?: string,\n  model: string = \"gpt-4-turbo-preview\"\n): Promise<string | null> {\n  const client = getOpenAIClient();\n  if (!client) {\n    logger.warn(\"Cannot generate response - OpenAI client not available\");\n    return null;\n  }\n\n  try {\n    const systemMessage = `You are an AI customer support agent for Aven, a fintech company that helps people save money while paying off credit card debt. \n    Be helpful, professional, and empathetic. Use the provided context to answer questions accurately.\n    If you don't have specific information, provide general guidance and suggest contacting Aven support.`;\n\n    const messages: ChatCompletionMessageParam[] = [\n      { role: \"system\", content: systemMessage },\n    ];\n\n    if (context) {\n      messages.push({\n        role: \"system\",\n        content: `Relevant information from our knowledge base:\\n${context}`,\n      });\n    }\n\n    messages.push({ role: \"user\", content: prompt });\n\n    const response = await client.chat.completions.create({\n      model,\n      messages,\n      temperature: 0.7,\n      max_tokens: 500,\n    });\n\n    const generatedText = response.choices[0].message.content;\n    logger.debug(\"Generated response from OpenAI\");\n    return generatedText;\n  } catch (error) {\n    logger.error(\"Failed to generate response\", { error });\n    return null;\n  }\n}\n\n// Chunk text for better embedding quality\nexport function chunkText(text: string, maxLength: number = 1000): string[] {\n  const sentences = text.match(/[^.!?]+[.!?]+/g) || [text];\n  const chunks: string[] = [];\n  let currentChunk = \"\";\n\n  for (const sentence of sentences) {\n    if ((currentChunk + sentence).length <= maxLength) {\n      currentChunk += sentence;\n    } else {\n      if (currentChunk) chunks.push(currentChunk.trim());\n      currentChunk = sentence;\n    }\n  }\n\n  if (currentChunk) chunks.push(currentChunk.trim());\n  return chunks;\n}\n\n// Calculate cosine similarity between two vectors\nexport function cosineSimilarity(a: number[], b: number[]): number {\n  if (a.length !== b.length) {\n    throw new Error(\"Vectors must have the same length\");\n  }\n\n  let dotProduct = 0;\n  let normA = 0;\n  let normB = 0;\n\n  for (let i = 0; i < a.length; i++) {\n    dotProduct += a[i] * b[i];\n    normA += a[i] * a[i];\n    normB += b[i] * b[i];\n  }\n\n  return dotProduct / (Math.sqrt(normA) * Math.sqrt(normB));\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 679, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 685, "column": 0}, "map": {"version":3,"sources":["file:///Users/williamding/Documents/GitHub/AI-Customer-Support-Agent/src/lib/pinecone.ts"],"sourcesContent":["import { Pinecone } from \"@pinecone-database/pinecone\";\nimport { env } from \"@/config/env\";\nimport { Logger } from \"@/utils/logger\";\n\nconst logger = new Logger(\"Pinecone\");\n\nlet pineconeClient: Pinecone | null = null;\n\nexport async function getPineconeClient(): Promise<Pinecone | null> {\n  if (!env.PINECONE_API_KEY) {\n    logger.warn(\"Pinecone API key not configured\");\n    return null;\n  }\n\n  if (!pineconeClient) {\n    try {\n      pineconeClient = new Pinecone({\n        apiKey: env.PINECONE_API_KEY,\n      });\n      logger.info(\"Pinecone client initialized successfully\");\n    } catch (error) {\n      logger.error(\"Failed to initialize Pinecone client\", { error });\n      return null;\n    }\n  }\n\n  return pineconeClient;\n}\n\nexport async function getIndex(indexName?: string) {\n  const client = await getPineconeClient();\n  if (!client) {\n    throw new Error(\"Pinecone client not available\");\n  }\n\n  const name = indexName || env.PINECONE_INDEX_NAME;\n\n  try {\n    const index = client.index(name);\n    logger.info(`Connected to Pinecone index: ${name}`);\n    return index;\n  } catch (error) {\n    logger.error(`Failed to connect to index ${name}`, { error });\n    throw error;\n  }\n}\n\nexport type VectorMetadata = {\n  id: string;\n  text: string;\n  category: string;\n  topic: string;\n  [key: string]: string | number | boolean;\n};\n\nexport async function upsertVectors(\n  vectors: { id: string; values: number[]; metadata: VectorMetadata }[],\n  indexName?: string\n) {\n  try {\n    const index = await getIndex(indexName);\n    const response = await index.upsert(vectors);\n    logger.info(`Upserted ${vectors.length} vectors to Pinecone`);\n    return response;\n  } catch (error) {\n    logger.error(\"Failed to upsert vectors\", { error });\n    throw error;\n  }\n}\n\nexport async function queryVectors(\n  queryVector: number[],\n  topK: number = 5,\n  filter?: Record<string, string | number | boolean>,\n  indexName?: string\n) {\n  try {\n    const index = await getIndex(indexName);\n    const queryResponse = await index.query({\n      vector: queryVector,\n      topK,\n      includeMetadata: true,\n      filter,\n    });\n\n    logger.info(\n      `Queried Pinecone, found ${queryResponse.matches?.length || 0} matches`\n    );\n    return queryResponse;\n  } catch (error) {\n    logger.error(\"Failed to query vectors\", { error });\n    throw error;\n  }\n}\n\nexport async function deleteAllVectors(indexName?: string) {\n  try {\n    const index = await getIndex(indexName);\n    await index.deleteAll();\n    logger.info(\"Deleted all vectors from Pinecone index\");\n  } catch (error) {\n    logger.error(\"Failed to delete vectors\", { error });\n    throw error;\n  }\n}\n\nexport async function createIndex(\n  indexName: string,\n  dimension: number = 1536, // Default for OpenAI embeddings\n  metric: \"cosine\" | \"euclidean\" | \"dotproduct\" = \"cosine\"\n) {\n  const client = await getPineconeClient();\n  if (!client) {\n    throw new Error(\"Pinecone client not available\");\n  }\n\n  try {\n    const indexes = await client.listIndexes();\n    const indexExists = indexes.indexes?.some(\n      index => index.name === indexName\n    );\n\n    if (indexExists) {\n      logger.info(`Index ${indexName} already exists`);\n      return;\n    }\n\n    await client.createIndex({\n      name: indexName,\n      dimension,\n      metric,\n      spec: {\n        serverless: {\n          cloud: \"aws\",\n          region: \"us-west-2\",\n        },\n      },\n    });\n\n    logger.info(`Created Pinecone index: ${indexName}`);\n\n    // Wait for index to be ready\n    await new Promise(resolve => setTimeout(resolve, 5000));\n  } catch (error) {\n    logger.error(`Failed to create index ${indexName}`, { error });\n    throw error;\n  }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 814, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 820, "column": 0}, "map": {"version":3,"sources":["file:///Users/williamding/Documents/GitHub/AI-Customer-Support-Agent/src/lib/rag.ts"],"sourcesContent":["import { avenKnowledgeBase } from \"@/data/aven-knowledge\";\nimport { createEmbedding, generateResponse } from \"@/lib/embeddings\";\nimport {\n  queryVectors,\n  upsertVectors,\n  createIndex,\n  VectorMetadata,\n} from \"@/lib/pinecone\";\nimport { Logger } from \"@/utils/logger\";\n\nconst logger = new Logger(\"RAG\");\n\n// Initialize the knowledge base in Pinecone\nexport async function initializeKnowledgeBase() {\n  try {\n    logger.info(\"Initializing Aven knowledge base in Pinecone\");\n\n    // Create index if it doesn't exist\n    await createIndex(\"aven-knowledge-base\");\n\n    // Prepare vectors\n    const vectors: {\n      id: string;\n      values: number[];\n      metadata: VectorMetadata;\n    }[] = [];\n\n    for (const item of avenKnowledgeBase) {\n      const embedding = await createEmbedding(item.content);\n      if (embedding) {\n        vectors.push({\n          id: item.id,\n          values: embedding,\n          metadata: {\n            id: item.id,\n            text: item.content,\n            category: item.category || \"general\",\n            topic: item.topic || \"general\",\n          },\n        });\n      }\n    }\n\n    if (vectors.length > 0) {\n      // Upsert vectors in batches to avoid rate limits\n      const batchSize = 100;\n      for (let i = 0; i < vectors.length; i += batchSize) {\n        const batch = vectors.slice(i, i + batchSize);\n        await upsertVectors(batch);\n        logger.info(\n          `Uploaded batch ${Math.floor(i / batchSize) + 1} of ${Math.ceil(vectors.length / batchSize)}`\n        );\n      }\n\n      logger.info(\n        `Successfully initialized knowledge base with ${vectors.length} vectors`\n      );\n    } else {\n      logger.warn(\"No vectors to upload - check OpenAI configuration\");\n    }\n\n    return vectors.length;\n  } catch (error) {\n    logger.error(\"Failed to initialize knowledge base\", { error });\n    throw error;\n  }\n}\n\n// Search for relevant context using vector similarity\nexport async function searchContext(\n  query: string,\n  topK: number = 5\n): Promise<string[]> {\n  try {\n    // Create embedding for the query\n    const queryEmbedding = await createEmbedding(query);\n    if (!queryEmbedding) {\n      logger.warn(\n        \"Could not create query embedding, falling back to text search\"\n      );\n      // Fallback to simple text search\n      const results = avenKnowledgeBase\n        .filter(\n          item =>\n            item.content.toLowerCase().includes(query.toLowerCase()) ||\n            item.topic.toLowerCase().includes(query.toLowerCase())\n        )\n        .slice(0, topK)\n        .map(item => item.content);\n      return results;\n    }\n\n    // Query Pinecone for similar vectors\n    const searchResults = await queryVectors(queryEmbedding, topK);\n\n    if (!searchResults.matches || searchResults.matches.length === 0) {\n      logger.warn(\"No matches found in vector search\");\n      return [];\n    }\n\n    // Extract and return the text content\n    const contexts = searchResults.matches\n      .filter(match => match.metadata && match.score && match.score > 0.7)\n      .map(match => (match.metadata as VectorMetadata).text);\n\n    logger.info(`Found ${contexts.length} relevant contexts for query`);\n    return contexts;\n  } catch (error) {\n    logger.error(\"Failed to search context\", { error });\n    // Fallback to local search\n    return avenKnowledgeBase\n      .filter(\n        item =>\n          item.content.toLowerCase().includes(query.toLowerCase()) ||\n          item.topic.toLowerCase().includes(query.toLowerCase())\n      )\n      .slice(0, topK)\n      .map(item => item.content);\n  }\n}\n\n// Generate a response using RAG\nexport async function generateRAGResponse(\n  userQuery: string,\n  conversationHistory?: { role: string; content: string }[]\n): Promise<{ response: string; contexts: string[] }> {\n  try {\n    logger.info(\"Generating RAG response for user query\");\n\n    // Search for relevant context\n    const contexts = await searchContext(userQuery, 5);\n\n    // Combine contexts into a single string\n    const contextString =\n      contexts.length > 0\n        ? contexts.join(\"\\n\\n\")\n        : \"No specific information found in knowledge base.\";\n\n    // Build conversation context\n    let conversationContext = \"\";\n    if (conversationHistory && conversationHistory.length > 0) {\n      conversationContext =\n        \"\\n\\nPrevious conversation:\\n\" +\n        conversationHistory\n          .slice(-4)\n          .map(msg => `${msg.role}: ${msg.content}`)\n          .join(\"\\n\");\n    }\n\n    // Create the full prompt\n    const fullPrompt = `User Question: ${userQuery}${conversationContext}`;\n\n    // Generate response\n    const response =\n      (await generateResponse(fullPrompt, contextString)) ||\n      \"I apologize, but I'm having trouble generating a response right now. Please try again or contact Aven support at 1-800-AVEN-HLP for immediate assistance.\";\n\n    logger.info(\"Successfully generated RAG response\");\n    return {\n      response,\n      contexts,\n    };\n  } catch (error) {\n    logger.error(\"Failed to generate RAG response\", { error });\n    return {\n      response:\n        \"I apologize for the inconvenience. I'm experiencing technical difficulties. Please contact Aven support at 1-800-AVEN-HLP (1-800-283-6457) for assistance, or try again later.\",\n      contexts: [],\n    };\n  }\n}\n\n// Simplified response for quick queries\nexport async function quickResponse(query: string): Promise<string> {\n  try {\n    const { response } = await generateRAGResponse(query);\n    return response;\n  } catch (error) {\n    logger.error(\"Failed to generate quick response\", { error });\n    return \"I'm here to help! However, I'm experiencing some technical issues. Please contact Aven support at 1-800-AVEN-HLP for immediate assistance.\";\n  }\n}\n\n// Get suggested questions based on category\nexport function getSuggestedQuestions(category?: string): string[] {\n  const suggestions = {\n    general: [\n      \"What is Aven and how does it work?\",\n      \"How can I apply for an Aven credit card?\",\n      \"What are the fees associated with Aven?\",\n      \"How does the balance transfer work?\",\n      \"What cashback rewards does Aven offer?\",\n    ],\n    account: [\n      \"How do I check my balance?\",\n      \"How can I make a payment?\",\n      \"Can I increase my credit limit?\",\n      \"How do I update my personal information?\",\n      \"Where can I find my statements?\",\n    ],\n    support: [\n      \"How do I report a lost or stolen card?\",\n      \"How can I dispute a charge?\",\n      \"What should I do if I'm having financial difficulties?\",\n      \"How do I contact customer support?\",\n      \"Is my information secure with Aven?\",\n    ],\n    features: [\n      \"What debt management tools does Aven offer?\",\n      \"How does the mobile app work?\",\n      \"Can I set up automatic payments?\",\n      \"What security features protect my account?\",\n      \"How do I earn and redeem cashback?\",\n    ],\n  };\n\n  return (\n    suggestions[category as keyof typeof suggestions] || suggestions.general\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 981, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 987, "column": 0}, "map": {"version":3,"sources":["file:///Users/williamding/Documents/GitHub/AI-Customer-Support-Agent/src/app/api/chat/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport { generateRAGResponse } from \"@/lib/rag\";\nimport { Logger } from \"@/utils/logger\";\n\nconst logger = new Logger(\"API:Chat\");\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json();\n    const { message, history } = body;\n\n    if (!message) {\n      return NextResponse.json(\n        { error: \"Message is required\" },\n        { status: 400 }\n      );\n    }\n\n    logger.info(\"Processing chat request\", { message });\n\n    // Generate response using RAG\n    const { response, contexts } = await generateRAGResponse(message, history);\n\n    logger.info(\"Generated chat response\", {\n      responseLength: response.length,\n      contextsCount: contexts.length,\n    });\n\n    return NextResponse.json({\n      response,\n      contexts,\n      timestamp: new Date().toISOString(),\n    });\n  } catch (error) {\n    logger.error(\"Chat API error\", { error });\n    return NextResponse.json(\n      {\n        error: \"Failed to process chat message\",\n        response:\n          \"I apologize, but I'm having trouble processing your request. Please try again or contact support at 1-800-AVEN-HLP.\",\n      },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;AAAA;AACA;AACA;;;;AAEA,MAAM,SAAS,IAAI,wHAAA,CAAA,SAAM,CAAC;AAEnB,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,OAAO,EAAE,OAAO,EAAE,GAAG;QAE7B,IAAI,CAAC,SAAS;YACZ,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAsB,GAC/B;gBAAE,QAAQ;YAAI;QAElB;QAEA,OAAO,IAAI,CAAC,2BAA2B;YAAE;QAAQ;QAEjD,8BAA8B;QAC9B,MAAM,EAAE,QAAQ,EAAE,QAAQ,EAAE,GAAG,MAAM,CAAA,GAAA,mHAAA,CAAA,sBAAmB,AAAD,EAAE,SAAS;QAElE,OAAO,IAAI,CAAC,2BAA2B;YACrC,gBAAgB,SAAS,MAAM;YAC/B,eAAe,SAAS,MAAM;QAChC;QAEA,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YACvB;YACA;YACA,WAAW,IAAI,OAAO,WAAW;QACnC;IACF,EAAE,OAAO,OAAO;QACd,OAAO,KAAK,CAAC,kBAAkB;YAAE;QAAM;QACvC,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACtB;YACE,OAAO;YACP,UACE;QACJ,GACA;YAAE,QAAQ;QAAI;IAElB;AACF"}},
    {"offset": {"line": 1034, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}}]
}